<%

library(RMySQL)
library(BUS)
mydb = dbConnect(MySQL(), user='root', password='loyola', dbname='rnaseqchipseq', host='localhost', unix.socket='/var/run/mysqld/mysqld.sock')

## List tables and fields
dbListTables(mydb)
dbListFields(mydb, 'rnaseq_expression')

## Select query
rs = dbSendQuery(mydb, "select id from fgs_rpkm where ear_tip > 1000")
data = fetch(rs, n=-1)
dim(data)
## 71 1

mydata <- read.table("/var/www/html/maize/data/all_FGS_fpkm_from_inflorescence_RNA-seq_exp.txt", header = T, row.names=1)
dim(mydata)

data <- as.matrix(data)
newmat <- mydata[t(data),]
dim(newmat)

similarity=gene.similarity(as.matrix(newmat), measure="MI", net.trim="mrnet")
pM=gene.pvalue(newmat, measure="MI", net.trim="mrnet")$single.perm.p.value
network <- pred.network(pM, similarity, thresh=0.05)

network <- network[rowSums(network) != 1, ]
network <- network[ ,colSums(network) != 0]

#isSymmetric(network)

network[lower.tri(network)] <- 0

cat(toJSON(network))

#cat('[ { "GRMZM2G016232": 1, "GRMZM2G041238": 0, "GRMZM2G152908": 0, "GRMZM2G132623": 0, "GRMZM2G063896": 1, "GRMZM2G129015": 0, "GRMZM2G153541": 0, "GRMZM2G419891": 0, "GRMZM2G004057": 0, "GRMZM2G063617": 0, "GRMZM2G046841": 0, "GRMZM2G385287": 0, "AC233865.1_FG001": 0, "GRMZM2G132077": 0, "GRMZM2G060106": 0, "GRMZM2G305046": 0.051664, "GRMZM2G072855": 0, "GRMZM2G044137": 0, "GRMZM2G180870": 0, "GRMZM2G024354": 0, "GRMZM2G165901": 0, "GRMZM5G827266": 0, "GRMZM5G898755": 0, "GRMZM2G172342": 0, "GRMZM2G099352": 0, "GRMZM2G154218": 0, "GRMZM5G895313": 0, "GRMZM2G125271": 0, "GRMZM2G152466": 0, "GRMZM2G001327": 0, "GRMZM2G046804": 0, "GRMZM5G815894": 0, "GRMZM2G340251": 0, "GRMZM2G180625": 0, "GRMZM2G054603": 0, "GRMZM2G143780": 0, "GRMZM2G084195": 0, "GRMZM2G472696": 0, "GRMZM2G180246": 0.051664, "GRMZM2G056039": 0, "GRMZM2G080603": 0, "GRMZM2G124317": 0, "GRMZM2G113720": 0, "GRMZM2G052869": 0, "GRMZM2G303374": 0, "GRMZM5G899149": 0, "GRMZM2G326111": 0, "GRMZM2G156673": 0, "GRMZM2G349651": 0, "GRMZM2G108348": 0, "GRMZM5G890561": 0, "GRMZM2G121075": 0, "AC195340.3_FG001": 0, "GRMZM2G119071": 0, "GRMZM2G150648": 0, "GRMZM2G077851": 0, "GRMZM2G421279": 1, "GRMZM5G873455": 0, "GRMZM2G066460": 0, "GRMZM2G051879": 0, "GRMZM5G881775": 0, "GRMZM2G020940": 0, "GRMZM2G101268": 0, "GRMZM2G479684": 0, "GRMZM2G015295": 0, "GRMZM2G181371": 0, "GRMZM2G149178": 0, "GRMZM2G167986": 0, "GRMZM2G168651": 0, "GRMZM2G153292": 0, "GRMZM5G834758": 0 }, { "GRMZM2G016232": 0, "GRMZM2G041238": 1, "GRMZM2G152908": 0, "GRMZM2G132623": 0, "GRMZM2G063896": 0, "GRMZM2G129015": 0, "GRMZM2G153541": 0, "GRMZM2G419891": 0, "GRMZM2G004057": 0, "GRMZM2G063617": 0, "GRMZM2G046841": 0, "GRMZM2G385287": 0, "AC233865.1_FG001": 0, "GRMZM2G132077": 0, "GRMZM2G060106": 0, "GRMZM2G305046": 0, "GRMZM2G072855": 0.051664, "GRMZM2G044137": 0, "GRMZM2G180870": 0, "GRMZM2G024354": 0, "GRMZM2G165901": 0, "GRMZM5G827266": 0, "GRMZM5G898755": 0, "GRMZM2G172342": 0, "GRMZM2G099352": 0, "GRMZM2G154218": 0, "GRMZM5G895313": 0, "GRMZM2G125271": 0, "GRMZM2G152466": 0, "GRMZM2G001327": 0, "GRMZM2G046804": 0, "GRMZM5G815894": 0, "GRMZM2G340251": 0, "GRMZM2G180625": 0, "GRMZM2G054603": 0, "GRMZM2G143780": 0, "GRMZM2G084195": 0, "GRMZM2G472696": 0, "GRMZM2G180246": 0, "GRMZM2G056039": 0, "GRMZM2G080603": 0, "GRMZM2G124317": 0, "GRMZM2G113720": 0, "GRMZM2G052869": 0, "GRMZM2G303374": 0, "GRMZM5G899149": 0, "GRMZM2G326111": 0, "GRMZM2G156673": 0, "GRMZM2G349651": 0, "GRMZM2G108348": 0, "GRMZM5G890561": 0, "GRMZM2G121075": 0, "AC195340.3_FG001": 0, "GRMZM2G119071": 0, "GRMZM2G150648": 0, "GRMZM2G077851": 0, "GRMZM2G421279": 0, "GRMZM5G873455": 0, "GRMZM2G066460": 0, "GRMZM2G051879": 0, "GRMZM5G881775": 0, "GRMZM2G020940": 0, "GRMZM2G101268": 0, "GRMZM2G479684": 0, "GRMZM2G015295": 0, "GRMZM2G181371": 0, "GRMZM2G149178": 0, "GRMZM2G167986": 0, "GRMZM2G168651": 0, "GRMZM2G153292": 0, "GRMZM5G834758": 0 }, { "GRMZM2G016232": 0, "GRMZM2G041238": 0, "GRMZM2G152908": 1, "GRMZM2G132623": 0, "GRMZM2G063896": 0, "GRMZM2G129015": 0, "GRMZM2G153541": 0, "GRMZM2G419891": 0, "GRMZM2G004057": 0, "GRMZM2G063617": 0, "GRMZM2G046841": 0, "GRMZM2G385287": 0, "AC233865.1_FG001": 0, "GRMZM2G132077": 0, "GRMZM2G060106": 0, "GRMZM2G305046": 0, "GRMZM2G072855": 0, "GRMZM2G044137": 0, "GRMZM2G180870": 0, "GRMZM2G024354": 0, "GRMZM2G165901": 0, "GRMZM5G827266": 0, "GRMZM5G898755": 0, "GRMZM2G172342": 0, "GRMZM2G099352": 0, "GRMZM2G154218": 0, "GRMZM5G895313": 0, "GRMZM2G125271": 0, "GRMZM2G152466": 0, "GRMZM2G001327": 0, "GRMZM2G046804": 0, "GRMZM5G815894": 0, "GRMZM2G340251": 0, "GRMZM2G180625": 0, "GRMZM2G054603": 0, "GRMZM2G143780": 0, "GRMZM2G084195": 0, "GRMZM2G472696": 0, "GRMZM2G180246": 0, "GRMZM2G056039": 0, "GRMZM2G080603": 0, "GRMZM2G124317": 0, "GRMZM2G113720": 0, "GRMZM2G052869": 0, "GRMZM2G303374": 0, "GRMZM5G899149": 0, "GRMZM2G326111": 0, "GRMZM2G156673": 0, "GRMZM2G349651": 0, "GRMZM2G108348": 0, "GRMZM5G890561": 0, "GRMZM2G121075": 0, "AC195340.3_FG001": 0, "GRMZM2G119071": 0, "GRMZM2G150648": 0, "GRMZM2G077851": 0, "GRMZM2G421279": 0, "GRMZM5G873455": 0, "GRMZM2G066460": 0, "GRMZM2G051879": 0, "GRMZM5G881775": 0, "GRMZM2G020940": 0, "GRMZM2G101268": 0, "GRMZM2G479684": 0, "GRMZM2G015295": 0, "GRMZM2G181371": 0, "GRMZM2G149178": 0, "GRMZM2G167986": 0, "GRMZM2G168651": 0, "GRMZM2G153292": 0, "GRMZM5G834758": 0 } ]')
%>